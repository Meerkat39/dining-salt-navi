# 本番データ収集・連携フローまとめ

## 目的

- Google Places API 等を活用し、実店舗データを収集・整形し、アプリで活用できる形にする
- 自前 DB 設計・連携も含め、運用可能なデータ基盤を構築する

## 収集・連携タスク一覧

1. **収集対象の定義**

   - [ ] 収集する店舗ジャンル・エリア・チェーン名などを決定
   - [ ] 必要なデータ項目（店名、住所、緯度経度、電話番号、営業時間など）を整理

2. **Google Places API の仕様確認・サンプル取得**

   - [ ] API ドキュメントを確認し、取得可能な項目・制限を把握
   - [ ] サンプルリクエストでデータ構造・レスポンス形式を確認

3. **API キー・利用制限の管理**

   - [ ] Google Cloud で API キー発行・制限設定
   - [ ] 利用上限・料金体系の確認

4. **データ収集スクリプトの作成**

   - [ ] エリア・キーワードごとに API リクエストを自動化
   - [ ] レスポンスデータを JSON/CSV 等で保存

5. **データクレンジング・重複除去**

   - [ ] 取得データの重複店舗・ノイズデータを除去
   - [ ] 必要な項目のみ抽出・整形

6. **自前 DB 設計・スキーマ定義**

   - [ ] chains, stores, menus テーブル設計
   - [ ] 必要なカラム・型・リレーションを定義

7. **DB へのインポート・紐付け**

   - [ ] 収集データを DB にインポート
   - [ ] チェーン・店舗・メニューの紐付け処理

8. **API レスポンス設計・フロント連携**

   - [ ] フロントで必要な形式に API レスポンスを整形
   - [ ] 必要に応じて API エンドポイント作成

9. **データ更新・運用フローの整理**
   - [ ] 定期的なデータ更新・新規店舗追加の運用方法を決定
   - [ ] 手動/自動収集のフローをドキュメント化

## 備考

- 収集・連携の進捗は `docs/TODO.md` で管理
- 実装例・サンプルスクリプトは `scripts/` ディレクトリ等に配置予定
- データ品質・運用性を重視し、随時改善・見直しを行う

---

### Google Places API キーの制限運用メモ

- 開発・ローカル実行時：自分のグローバル IP を「IP アドレス制限」に追加
- 本番公開時：デプロイ先サーバーのグローバル IP を「IP アドレス制限」に追加
- フロントエンド（地図表示）：リファラー制限（公開ドメイン https://yourdomain.com/* など）
- バックエンド/バッチ処理：IP アドレス制限（サーバー IP 指定）
- API キーは用途ごとに分けて管理するのが安全

【注意】
「制限なし」は動作確認には便利だが、セキュリティリスクが高いため本番運用では避けること
IP アドレスは Google で「自分の IP アドレス」と検索、またはサーバー管理画面等で確認可能
クラウドサーバーは IP が変わる場合があるので注意
