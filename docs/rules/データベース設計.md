# データベース設計

このドキュメントは「外食塩分ナビ」アプリのデータベース設計（エンティティ・テーブル定義・リレーション）をまとめたものです。

## 1. メニュー（menus）

| カラム名 | 型           | 主キー | NULL 許容 | 備考                                                 |
| -------- | ------------ | ------ | --------- | ---------------------------------------------------- |
| id       | UUID         | ○      | ×         | メニュー ID（PK）                                    |
| chain_id | UUID         | FK     | ×         | チェーン ID（chains.id）                             |
| name     | VARCHAR(100) |        | ×         | メニュー名（ChainMenus 型でチェーン単位管理も併用）  |
| salt     | DOUBLE       |        | ×         | 塩分量（g）（ChainMenus 型でチェーン単位管理も併用） |
| price    | INT          |        | ×         | 価格（円）（ChainMenus 型でチェーン単位管理も併用）  |

## 2. チェーンごとのメニュー一覧（ChainMenus：JSON 管理用）

| カラム名 | 型   | 主キー | NULL 許容 | 備考                     |
| -------- | ---- | ------ | --------- | ------------------------ |
| chain_id | UUID | ○      | ×         | チェーン ID（chains.id） |
| menus    | 配列 |        | ×         | メニュー配列（Menu 型）  |

※ ChainMenus は DB テーブルではなく、JSON 管理・アプリ内連携用の構造です。

## 3. リレーション

チェーン（chains）1 : N 店舗（stores）
チェーン（chains）1 : 1 チェーンごとのメニュー一覧（ChainMenus）

- chains.id = stores.chain_id
- chains.id = ChainMenus.chain_id

## 4. ER 図（簡易）

```
┌────────────┐      1      ┌─────────────┐
│  chains    │───────────▶ │  stores     │
├────────────┤      N      ├─────────────┤
│ id (PK)    │             │ id (PK)     │
│ name       │             │ chain_id(FK)│
└─────┬──────┘             │ name        │
      │                    │ address     │
      │                    │ lat         │
      │                    │ lng         │
      │                    │ place_id    │
      │                    └─────────────┘
      │
      ▼
┌────────────┐
│ ChainMenus │
├────────────┤
│ chain_id   │
│ menus[]    │
│  ├─ id     │
│  ├─ name   │
│  └─ salt   │
└────────────┘
```

## 5. TypeScript 型定義との対応

```ts
// チェーン情報
export type Chain = {
  id: string;
  name: string;
  created_at: string;
  updated_at: string;
};

// 店舗情報
export type Store = {
  id: string;
  chain_id: string;
  name: string;
  address: string;
  lat: number;
  lng: number;
  place_id?: string;
  created_at: string;
  updated_at: string;
};

// メニュー情報（menus.json構造に合わせた例）
export type Menu = {
  id: string;
  name: string;
  salt: number;
  created_at: string;
  updated_at: string;
};

// チェーンごとのメニュー一覧（menus.json構造例）
export type ChainMenus = {
  chain_id: string;
  menus: Menu[];
};
```

- Chain 型 ⇔ chains テーブル
- Store 型 ⇔ stores テーブル
- Menu 型 ⇔ menus テーブル（chain_id で紐付け）
- ChainMenus 型 ⇔ menus.json（chain_id を最上位で持つ構造）

---

## 運用メモ（Google API と DB の関係）

- 店舗情報は「Google Places API 等で事前に取得」→「DB に保存」→「アプリは DB 参照」が基本運用
- 独自情報（チェーン ID、減塩メニュー、栄養成分など）は DB で一元管理
- アプリから Google API を直接叩くのは「リアルタイム検索」や「最新情報取得」用途のみ

この設計なら、API コスト・独自情報管理・拡張性のバランスが良いです。
