# データベース設計

このドキュメントは「外食塩分ナビ」アプリのデータベース設計（エンティティ・テーブル定義・リレーション）をまとめたものです。

## 1. エンティティ一覧

1. チェーン（Chain）
2. 店舗（Store）
3. メニュー（Menu）

## 2. テーブル定義

### 2.1 チェーン（chains）

| カラム名 | 型           | 主キー | NULL 許容 | 備考              |
| -------- | ------------ | ------ | --------- | ----------------- |
| id       | UUID         | ○      | ×         | チェーン ID（PK） |
| name     | VARCHAR(100) |        | ×         | チェーン名        |

### 2.2 店舗（stores）

| カラム名 | 型           | 主キー | NULL 許容 | 備考                     |
| -------- | ------------ | ------ | --------- | ------------------------ |
| id       | UUID         | ○      | ×         | 店舗 ID（PK）            |
| chain_id | UUID         | FK     | ×         | チェーン ID（chains.id） |
| name     | VARCHAR(100) |        | ×         | 店舗名                   |
| lat      | DOUBLE       |        | ×         | 緯度                     |
| lng      | DOUBLE       |        | ×         | 経度                     |

### 2.3 メニュー（menus）

| カラム名   | 型           | 主キー | NULL 許容 | 備考                     |
| ---------- | ------------ | ------ | --------- | ------------------------ |
| id         | UUID         | ○      | ×         | メニュー ID（PK）        |
| chain_id   | UUID         | FK     | ×         | チェーン ID（chains.id） |
| name       | VARCHAR(100) |        | ×         | メニュー名               |
| salt       | DOUBLE       |        | ×         | 塩分量（g）              |
| price      | INT          |        | ×         | 価格（円）               |
| created_at | TIMESTAMP    |        | ×         | 登録日時                 |
| updated_at | TIMESTAMP    |        | ×         | 更新日時                 |

## 3. リレーション

チェーン（chains）1 : N 店舗（stores）
チェーン（chains）1 : N メニュー（menus）

- chains.id = stores.chain_id
- chains.id = menus.chain_id

## 4. ER 図（簡易）

```
┌────────────┐      1      ┌────────────┐
│  chains    │───────────▶ │  stores    │
├────────────┤      N      ├────────────┤
│ id (PK)    │             │ id (PK)    │
│ name       │             │ chain_id   │
│            │             │ name       │
│            │             │ lat        │
│            │             │ lng        │
└────────────┘             └────────────┘

┌────────────┐             ┌────────────┐
│  chains    │───────────▶ │   menus    │
├────────────┤      N      ├────────────┤
│ id (PK)    │             │ id (PK)    │
│ name       │             │ chain_id   │
│            │             │ name       │
│            │             │ salt       │
│            │             │ price      │
│            │             │ created_at │
│            │             │ updated_at │
└────────────┘             └────────────┘
```

## 5. TypeScript 型定義との対応

```ts
// チェーン情報
export type Chain = {
  id: string;
  name: string;
};

// 店舗情報
export type Store = {
  id: string;
  chain_id: string;
  name: string;
  lat: number;
  lng: number;
};

// メニュー情報（チェーンごとに共通）
export type Menu = {
  id: string;
  chain_id: string;
  name: string;
  salt: number;
  price: number;
  created_at: string; // ISO文字列
  updated_at: string; // ISO文字列
};
```

- Chain 型 ⇔ chains テーブル
- Store 型 ⇔ stores テーブル
- Menu 型 ⇔ menus テーブル（chain_id で紐付け）

---

## 運用メモ（Google API と DB の関係）

- 店舗情報は「Google Places API 等で事前に取得」→「DB に保存」→「アプリは DB 参照」が基本運用
- 独自情報（チェーン ID、減塩メニュー、栄養成分など）は DB で一元管理
- アプリから Google API を直接叩くのは「リアルタイム検索」や「最新情報取得」用途のみ

この設計なら、API コスト・独自情報管理・拡張性のバランスが良いです。
